# Stack Watcher テスト設計書

## 1. テスト戦略

### 1.1 テストピラミッド
```
        E2E Tests (10%)
       ─────────────────
      Integration Tests (20%)
     ──────────────────────────
    Unit Tests (70%)
   ────────────────────────────────
```

### 1.2 テスト方針
- **カバレッジ目標**: 80%以上
- **テスト駆動開発**: 重要な機能から適用
- **自動化**: CI/CDパイプラインでの自動実行
- **品質保証**: パフォーマンス・セキュリティ・アクセシビリティ

### 1.3 テストツール構成

#### フロントエンド
- **Unit Testing**: Vitest + Vue Test Utils
- **E2E Testing**: Playwright
- **Component Testing**: Vue Test Utils
- **Visual Regression**: Chromatic (Storybook)

#### バックエンド
- **Unit Testing**: pytest + pytest-asyncio
- **Integration Testing**: pytest + FastAPI TestClient
- **API Testing**: pytest + httpx
- **Load Testing**: Locust

## 2. ユニットテスト設計

### 2.1 フロントエンドユニットテスト

#### 2.1.1 Store（Pinia）テスト

##### stockStore.test.js
```javascript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'
import { useStockStore } from '@/stores/stockStore'
import * as stockService from '@/services/stockService'

vi.mock('@/services/stockService')

describe('Stock Store', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
    vi.clearAllMocks()
  })

  describe('初期状態', () => {
    it('初期値が正しく設定されている', () => {
      const store = useStockStore()
      
      expect(store.stocks).toEqual([])
      expect(store.selectedSymbols).toEqual(['6326', '9984', '1377'])
      expect(store.period).toBe('7d')
      expect(store.isLoading).toBe(false)
      expect(store.error).toBeNull()
    })
  })

  describe('getters', () => {
    it('getStockBySymbol が正しく動作する', () => {
      const store = useStockStore()
      store.stocks = [
        { symbol: '6326', company_name: 'クボタ' },
        { symbol: '9984', company_name: 'ソフトバンク' }
      ]

      const kubota = store.getStockBySymbol('6326')
      expect(kubota.company_name).toBe('クボタ')
      
      const notFound = store.getStockBySymbol('0000')
      expect(notFound).toBeUndefined()
    })

    it('hasData が正しく動作する', () => {
      const store = useStockStore()
      
      expect(store.hasData).toBe(false)
      
      store.stocks = [{ symbol: '6326' }]
      expect(store.hasData).toBe(true)
    })
  })

  describe('actions', () => {
    it('fetchStocks が成功する', async () => {
      const mockResponse = {
        data: {
          stocks: [
            { symbol: '6326', company_name: 'クボタ' }
          ]
        }
      }
      stockService.getStocks.mockResolvedValue(mockResponse)

      const store = useStockStore()
      await store.fetchStocks()

      expect(store.isLoading).toBe(false)
      expect(store.stocks).toEqual(mockResponse.data.stocks)
      expect(store.error).toBeNull()
      expect(store.lastUpdated).toBeDefined()
    })

    it('fetchStocks がエラーを処理する', async () => {
      const errorMessage = 'API Error'
      stockService.getStocks.mockRejectedValue(new Error(errorMessage))

      const store = useStockStore()
      await store.fetchStocks()

      expect(store.isLoading).toBe(false)
      expect(store.error).toBe(errorMessage)
    })

    it('setPeriod が正しく動作する', async () => {
      stockService.getStocks.mockResolvedValue({ data: { stocks: [] } })
      
      const store = useStockStore()
      store.setPeriod('1m')

      expect(store.period).toBe('1m')
      expect(stockService.getStocks).toHaveBeenCalled()
    })
  })
})
```

#### 2.1.2 コンポーネントテスト

##### StockChart.test.js
```javascript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import { createPinia, setActivePinia } from 'pinia'
import StockChart from '@/components/charts/StockChart.vue'
import { useStockStore } from '@/stores/stockStore'
import { useColorStore } from '@/stores/colorStore'

// EChartsをモック
vi.mock('echarts', () => ({
  init: vi.fn(() => ({
    setOption: vi.fn(),
    dispose: vi.fn(),
    resize: vi.fn(),
    on: vi.fn(),
    showLoading: vi.fn(),
    hideLoading: vi.fn()
  }))
}))

describe('StockChart Component', () => {
  let wrapper
  let stockStore
  let colorStore

  beforeEach(() => {
    setActivePinia(createPinia())
    stockStore = useStockStore()
    colorStore = useColorStore()
    
    // テストデータの設定
    stockStore.stocks = [
      {
        symbol: '6326',
        company_name: 'クボタ',
        data_points: [
          { date: '2025-09-20T09:00:00Z', close: 2500 },
          { date: '2025-09-21T09:00:00Z', close: 2550 }
        ]
      }
    ]
    
    colorStore.colors = {
      stocks: {
        '6326': '#2563eb'
      }
    }

    wrapper = mount(StockChart)
  })

  it('コンポーネントが正しくレンダリングされる', () => {
    expect(wrapper.find('h3').text()).toBe('株価推移')
    expect(wrapper.find('.bg-white').exists()).toBe(true)
  })

  it('銘柄の凡例が表示される', () => {
    const legend = wrapper.find('.flex.items-center.space-x-2')
    expect(legend.exists()).toBe(true)
    expect(legend.text()).toContain('クボタ')
  })

  it('ローディング状態が正しく処理される', async () => {
    stockStore.isLoading = true
    await wrapper.vm.$nextTick()
    
    // BaseChartにloadingプロパティが渡されることを確認
    const baseChart = wrapper.findComponent({ name: 'BaseChart' })
    expect(baseChart.props('loading')).toBe(true)
  })

  it('データズーム イベントが処理される', async () => {
    const baseChart = wrapper.findComponent({ name: 'BaseChart' })
    const zoomParams = { start: 10, end: 90 }
    
    await baseChart.vm.$emit('data-zoom', zoomParams)
    
    // UIストアの状態が更新されることを確認（実装に応じて）
    // expect(...).toBe(...)
  })
})
```

#### 2.1.3 Composablesテスト

##### useStock.test.js
```javascript
import { describe, it, expect, beforeEach } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'
import { useStock } from '@/composables/useStock'
import { useStockStore } from '@/stores/stockStore'

describe('useStock Composable', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('ストアの状態を正しく返す', () => {
    const store = useStockStore()
    const { stocks, isLoading, error, selectedSymbols } = useStock()

    store.stocks = [{ symbol: '6326' }]
    store.isLoading = true
    store.error = 'Test error'
    store.selectedSymbols = ['6326']

    expect(stocks.value).toEqual([{ symbol: '6326' }])
    expect(isLoading.value).toBe(true)
    expect(error.value).toBe('Test error')
    expect(selectedSymbols.value).toEqual(['6326'])
  })

  it('getStockBySymbol が正しく動作する', () => {
    const store = useStockStore()
    const { getStockBySymbol } = useStock()

    store.stocks = [
      { symbol: '6326', company_name: 'クボタ' }
    ]

    const result = getStockBySymbol('6326')
    expect(result.company_name).toBe('クボタ')
  })
})
```

### 2.2 バックエンドユニットテスト

#### 2.2.1 API エンドポイントテスト

##### test_stocks_api.py
```python
import pytest
from fastapi.testclient import TestClient
from unittest.mock import Mock, patch
from datetime import datetime, timezone

from backend.main import app
from backend.services.stock_service import StockService

client = TestClient(app)

class TestStocksAPI:
    """株価API のテストクラス"""
    
    def test_get_stock_success(self, mock_stock_service):
        """株価データ取得成功のテスト"""
        # モックデータ
        mock_data = {
            "symbol": "6326",
            "company_name": "クボタ",
            "data_points": [
                {
                    "date": "2025-09-20T09:00:00Z",
                    "open": 2500.0,
                    "high": 2550.0,
                    "low": 2480.0,
                    "close": 2530.0,
                    "volume": 1000000
                }
            ]
        }
        
        mock_stock_service.get_stock_data.return_value = mock_data
        
        # APIコール
        response = client.get("/api/v1/stocks/6326?period=7d")
        
        # アサーション
        assert response.status_code == 200
        data = response.json()
        assert data["success"] is True
        assert data["data"]["symbol"] == "6326"
        assert data["data"]["company_name"] == "クボタ"
        assert len(data["data"]["data_points"]) == 1
        
    def test_get_stock_invalid_symbol(self):
        """無効な銘柄コードのテスト"""
        response = client.get("/api/v1/stocks/9999")
        
        assert response.status_code == 400
        data = response.json()
        assert data["success"] is False
        assert data["error"]["code"] == "INVALID_SYMBOL"
        
    def test_get_stock_invalid_period(self):
        """無効な期間指定のテスト"""
        response = client.get("/api/v1/stocks/6326?period=invalid")
        
        assert response.status_code == 400
        data = response.json()
        assert data["success"] is False
        assert data["error"]["code"] == "INVALID_PERIOD"
        
    def test_get_multiple_stocks_success(self, mock_stock_service):
        """複数銘柄取得成功のテスト"""
        mock_data = {
            "stocks": [
                {"symbol": "6326", "company_name": "クボタ", "data_points": []},
                {"symbol": "9984", "company_name": "ソフトバンク", "data_points": []}
            ]
        }
        
        mock_stock_service.get_multiple_stocks.return_value = mock_data
        
        response = client.get("/api/v1/stocks?symbols=6326,9984")
        
        assert response.status_code == 200
        data = response.json()
        assert data["success"] is True
        assert len(data["data"]["stocks"]) == 2

@pytest.fixture
def mock_stock_service():
    """StockService のモック"""
    with patch('backend.services.stock_service.StockService') as mock:
        yield mock.return_value
```

#### 2.2.2 サービスクラステスト

##### test_stock_service.py
```python
import pytest
from unittest.mock import Mock, patch, AsyncMock
from datetime import datetime, timezone

from backend.services.stock_service import StockService
from backend.models.stock import StockData

class TestStockService:
    """StockService のテストクラス"""
    
    @pytest.fixture
    def stock_service(self):
        return StockService()
    
    @pytest.mark.asyncio
    async def test_get_stock_data_success(self, stock_service):
        """株価データ取得成功のテスト"""
        with patch('backend.external.yahoo_finance.YahooFinanceClient') as mock_client:
            # モックの設定
            mock_instance = mock_client.return_value
            mock_instance.get_stock_data = AsyncMock(return_value={
                "symbol": "6326",
                "data": [
                    {
                        "date": datetime(2025, 9, 20, tzinfo=timezone.utc),
                        "open": 2500.0,
                        "high": 2550.0,
                        "low": 2480.0,
                        "close": 2530.0,
                        "volume": 1000000
                    }
                ]
            })
            
            # テスト実行
            result = await stock_service.get_stock_data("6326", "7d")
            
            # アサーション
            assert result["symbol"] == "6326"
            assert len(result["data_points"]) == 1
            assert result["data_points"][0]["close"] == 2530.0
            
    @pytest.mark.asyncio
    async def test_get_stock_data_external_api_error(self, stock_service):
        """外部API エラーのテスト"""
        with patch('backend.external.yahoo_finance.YahooFinanceClient') as mock_client:
            mock_instance = mock_client.return_value
            mock_instance.get_stock_data = AsyncMock(
                side_effect=Exception("Yahoo Finance API Error")
            )
            
            with pytest.raises(Exception) as exc_info:
                await stock_service.get_stock_data("6326", "7d")
                
            assert "Yahoo Finance API Error" in str(exc_info.value)
            
    def test_validate_symbol_valid(self, stock_service):
        """有効な銘柄コードのバリデーション"""
        valid_symbols = ["6326", "9984", "1377"]
        
        for symbol in valid_symbols:
            assert stock_service.validate_symbol(symbol) is True
            
    def test_validate_symbol_invalid(self, stock_service):
        """無効な銘柄コードのバリデーション"""
        invalid_symbols = ["9999", "invalid", "", None]
        
        for symbol in invalid_symbols:
            assert stock_service.validate_symbol(symbol) is False
            
    def test_validate_period_valid(self, stock_service):
        """有効な期間のバリデーション"""
        valid_periods = ["7d", "1m", "3m"]
        
        for period in valid_periods:
            assert stock_service.validate_period(period) is True
            
    def test_validate_period_invalid(self, stock_service):
        """無効な期間のバリデーション"""
        invalid_periods = ["1d", "6m", "1y", "invalid", "", None]
        
        for period in invalid_periods:
            assert stock_service.validate_period(period) is False
```

## 3. 統合テスト設計

### 3.1 API統合テスト

#### test_api_integration.py
```python
import pytest
from fastapi.testclient import TestClient
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

from backend.main import app
from backend.database import get_db, Base

# テスト用データベース設定
SQLALCHEMY_DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(SQLALCHEMY_DATABASE_URL, connect_args={"check_same_thread": False})
TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def override_get_db():
    try:
        db = TestingSessionLocal()
        yield db
    finally:
        db.close()

app.dependency_overrides[get_db] = override_get_db

class TestAPIIntegration:
    """API統合テスト"""
    
    @pytest.fixture(scope="class", autouse=True)
    def setup_database(self):
        """テストデータベースのセットアップ"""
        Base.metadata.create_all(bind=engine)
        yield
        Base.metadata.drop_all(bind=engine)
    
    def test_stock_api_flow(self):
        """株価API の一連の流れをテスト"""
        client = TestClient(app)
        
        # 1. ヘルスチェック
        response = client.get("/api/v1/health")
        assert response.status_code == 200
        
        # 2. 銘柄一覧取得
        response = client.get("/api/v1/stocks/symbols")
        assert response.status_code == 200
        symbols = response.json()["data"]["symbols"]
        assert len(symbols) >= 3
        
        # 3. 個別銘柄データ取得
        first_symbol = symbols[0]["symbol"]
        response = client.get(f"/api/v1/stocks/{first_symbol}")
        assert response.status_code == 200
        
        # 4. 複数銘柄データ取得
        symbol_list = ",".join([s["symbol"] for s in symbols[:2]])
        response = client.get(f"/api/v1/stocks?symbols={symbol_list}")
        assert response.status_code == 200
        
        # 5. カラーマスタ取得
        response = client.get("/api/v1/colors/master")
        assert response.status_code == 200
```

### 3.2 フロントエンド統合テスト

#### integration.test.js
```javascript
import { describe, it, expect, beforeEach } from 'vitest'
import { mount } from '@vue/test-utils'
import { createPinia, setActivePinia } from 'pinia'
import { createRouter, createWebHistory } from 'vue-router'
import App from '@/App.vue'
import Dashboard from '@/views/Dashboard.vue'
import { routes } from '@/router'

describe('アプリケーション統合テスト', () => {
  let router
  let wrapper

  beforeEach(async () => {
    setActivePinia(createPinia())
    
    router = createRouter({
      history: createWebHistory(),
      routes
    })
    
    router.push('/')
    await router.isReady()
    
    wrapper = mount(App, {
      global: {
        plugins: [router]
      }
    })
  })

  it('ダッシュボード画面が正しく表示される', async () => {
    expect(wrapper.findComponent(Dashboard).exists()).toBe(true)
    expect(wrapper.find('header').exists()).toBe(true)
    expect(wrapper.find('aside').exists()).toBe(true)
    expect(wrapper.find('footer').exists()).toBe(true)
  })

  it('サイドバーの展開/折りたたみが動作する', async () => {
    const sidebar = wrapper.find('aside')
    
    // 初期状態では折りたたまれている
    expect(sidebar.classes()).toContain('w-16')
    
    // マウスオーバーで展開
    await sidebar.trigger('mouseenter')
    expect(sidebar.classes()).toContain('w-72')
    
    // マウスリーブで折りたたみ
    await sidebar.trigger('mouseleave')
    expect(sidebar.classes()).toContain('w-16')
  })
})
```

## 4. E2Eテスト設計

### 4.1 Playwright E2Eテスト

#### stock-chart.spec.js
```javascript
import { test, expect } from '@playwright/test'

test.describe('株価チャート機能', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/')
    await page.waitForLoadState('networkidle')
  })

  test('株価チャートが表示される', async ({ page }) => {
    // チャートコンテナの存在確認
    const chartContainer = page.locator('[data-testid="stock-chart"]')
    await expect(chartContainer).toBeVisible()
    
    // チャートタイトルの確認
    await expect(page.locator('h3:has-text("株価推移")')).toBeVisible()
    
    // 凡例の確認
    await expect(page.locator('text=クボタ')).toBeVisible()
    await expect(page.locator('text=ソフトバンク')).toBeVisible()
    await expect(page.locator('text=サカタのタネ')).toBeVisible()
  })

  test('期間選択が動作する', async ({ page }) => {
    // 7日間から1ヶ月に変更
    await page.click('[data-testid="period-selector"]')
    await page.click('text=1ヶ月')
    
    // ローディング表示の確認
    await expect(page.locator('[data-testid="loading"]')).toBeVisible()
    
    // データ更新後の確認
    await page.waitForLoadState('networkidle')
    await expect(page.locator('[data-testid="loading"]')).not.toBeVisible()
  })

  test('チャートのズーム機能が動作する', async ({ page }) => {
    const chart = page.locator('[data-testid="stock-chart"]')
    
    // チャート領域でマウスホイールによるズーム
    await chart.hover()
    await page.mouse.wheel(0, -100) // ズームイン
    
    // ズーム後の状態確認（実装に応じて調整）
    // await expect(...).toBe(...)
  })

  test('サイドバーでの銘柄選択が動作する', async ({ page }) => {
    // サイドバーを展開
    const sidebar = page.locator('[data-testid="sidebar"]')
    await sidebar.hover()
    
    // 銘柄のチェックボックスを操作
    await page.uncheck('input[value="1377"]') // サカタのタネを非選択
    
    // チャートからサカタのタネが消えることを確認
    await expect(page.locator('text=サカタのタネ')).not.toBeVisible()
    
    // 再度選択
    await page.check('input[value="1377"]')
    await expect(page.locator('text=サカタのタネ')).toBeVisible()
  })

  test('レスポンシブ対応', async ({ page }) => {
    // モバイルサイズに変更
    await page.setViewportSize({ width: 375, height: 667 })
    
    // ハンバーガーメニューの表示確認
    await expect(page.locator('[data-testid="mobile-menu-button"]')).toBeVisible()
    
    // サイドバーが自動で非表示になることを確認
    const sidebar = page.locator('[data-testid="sidebar"]')
    await expect(sidebar).toHaveClass(/w-16/)
  })
})
```

#### api-error-handling.spec.js
```javascript
import { test, expect } from '@playwright/test'

test.describe('エラーハンドリング', () => {
  test('APIエラー時のエラー表示', async ({ page }) => {
    // APIレスポンスをモック（エラー）
    await page.route('**/api/v1/stocks**', route => {
      route.fulfill({
        status: 500,
        contentType: 'application/json',
        body: JSON.stringify({
          success: false,
          error: {
            code: 'INTERNAL_SERVER_ERROR',
            message: 'サーバー内部エラーが発生しました'
          }
        })
      })
    })
    
    await page.goto('/')
    
    // エラーメッセージの表示確認
    await expect(page.locator('[data-testid="error-message"]')).toBeVisible()
    await expect(page.locator('text=サーバー内部エラーが発生しました')).toBeVisible()
    
    // リトライボタンの確認
    await expect(page.locator('[data-testid="retry-button"]')).toBeVisible()
  })

  test('ネットワークエラー時の処理', async ({ page }) => {
    // ネットワークを無効化
    await page.context().setOffline(true)
    
    await page.goto('/')
    
    // オフライン表示の確認
    await expect(page.locator('[data-testid="offline-indicator"]')).toBeVisible()
  })
})
```

## 5. パフォーマンステスト

### 5.1 フロントエンドパフォーマンス

#### lighthouse.test.js
```javascript
import { test } from '@playwright/test'
import { playAudit } from 'playwright-lighthouse'

test.describe('Lighthouse パフォーマンステスト', () => {
  test('パフォーマンス指標の確認', async ({ page }) => {
    await page.goto('/')
    
    await playAudit({
      page,
      thresholds: {
        performance: 90,
        accessibility: 95,
        'best-practices': 90,
        seo: 90,
        pwa: 50
      },
      port: 9222
    })
  })
})
```

### 5.2 バックエンドロードテスト

#### locustfile.py
```python
from locust import HttpUser, task, between

class StockWatcherUser(HttpUser):
    wait_time = between(1, 3)
    
    def on_start(self):
        """テスト開始時の処理"""
        self.symbols = ["6326", "9984", "1377"]
        self.periods = ["7d", "1m", "3m"]
    
    @task(3)
    def get_single_stock(self):
        """個別銘柄データ取得"""
        symbol = self.symbols[0]
        period = self.periods[0]
        
        with self.client.get(
            f"/api/v1/stocks/{symbol}?period={period}",
            catch_response=True
        ) as response:
            if response.status_code == 200:
                response.success()
            else:
                response.failure(f"Failed with status {response.status_code}")
    
    @task(2)
    def get_multiple_stocks(self):
        """複数銘柄データ取得"""
        symbols = ",".join(self.symbols)
        period = self.periods[0]
        
        with self.client.get(
            f"/api/v1/stocks?symbols={symbols}&period={period}",
            catch_response=True
        ) as response:
            if response.status_code == 200:
                response.success()
            else:
                response.failure(f"Failed with status {response.status_code}")
    
    @task(1)
    def get_colors(self):
        """カラーマスタ取得"""
        self.client.get("/api/v1/colors/master")
    
    @task(1)
    def health_check(self):
        """ヘルスチェック"""
        self.client.get("/api/v1/health")
```

## 6. テスト実行・CI/CD

### 6.1 package.json スクリプト
```json
{
  "scripts": {
    "test": "vitest",
    "test:unit": "vitest run",
    "test:coverage": "vitest run --coverage",
    "test:e2e": "playwright test",
    "test:e2e:headed": "playwright test --headed",
    "test:component": "vitest --environment jsdom",
    "test:all": "npm run test:unit && npm run test:e2e"
  }
}
```

### 6.2 GitHub Actions ワークフロー

#### .github/workflows/test.yml
```yaml
name: Test Suite

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  frontend-tests:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: Install dependencies
      run: npm ci
      working-directory: frontend
    
    - name: Run unit tests
      run: npm run test:coverage
      working-directory: frontend
    
    - name: Upload coverage reports
      uses: codecov/codecov-action@v3
      with:
        directory: frontend/coverage
    
    - name: Install Playwright
      run: npx playwright install
      working-directory: frontend
    
    - name: Run E2E tests
      run: npm run test:e2e
      working-directory: frontend

  backend-tests:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:13
        env:
          POSTGRES_PASSWORD: testpass
          POSTGRES_DB: testdb
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest pytest-asyncio pytest-cov
      working-directory: backend
    
    - name: Run tests
      run: pytest --cov=. --cov-report=xml
      working-directory: backend
      env:
        DATABASE_URL: postgresql://postgres:testpass@localhost/testdb
    
    - name: Upload coverage reports
      uses: codecov/codecov-action@v3
      with:
        directory: backend
```

## 7. テストデータ管理

### 7.1 フィクスチャデータ

#### fixtures/stock_data.json
```json
{
  "stocks": [
    {
      "symbol": "6326",
      "company_name": "クボタ",
      "data_points": [
        {
          "date": "2025-09-20T09:00:00Z",
          "open": 2500.0,
          "high": 2550.0,
          "low": 2480.0,
          "close": 2530.0,
          "volume": 1000000
        }
      ]
    }
  ]
}
```

### 7.2 テストユーティリティ

#### test-utils.js
```javascript
import { createPinia, setActivePinia } from 'pinia'
import { mount } from '@vue/test-utils'

export function createTestPinia() {
  const pinia = createPinia()
  setActivePinia(pinia)
  return pinia
}

export function mountWithPinia(component, options = {}) {
  const pinia = createTestPinia()
  
  return mount(component, {
    global: {
      plugins: [pinia],
      ...options.global
    },
    ...options
  })
}

export const mockStockData = {
  symbol: "6326",
  company_name: "クボタ",
  data_points: [
    {
      date: "2025-09-20T09:00:00Z",
      open: 2500.0,
      high: 2550.0,
      low: 2480.0,
      close: 2530.0,
      volume: 1000000
    }
  ]
}
```

---

**作成日**: 2025年9月20日  
**バージョン**: 1.0  
**対象フェーズ**: Phase 1 MVP